#INFO: **** input file is /Users/omtailor/P3/scripts/run_pyscf_dbt.py ****
#!/usr/bin/env python3
import argparse
import numpy as np
from pyscf import gto, scf, mcscf

def main(basis):
    # 1) Build the molecule
    mol = gto.Mole()
    mol.atom = 'dbt_geometry/dbt_opt_opt.xyz'
    mol.basis = basis
    mol.verbose = 4
    mol.build()

    # 2) RHF reference
    mf = scf.RHF(mol)
    rhf_energy = mf.kernel()
    print(f"RHF/{basis} energy = {rhf_energy:.6f} Ha")

    # 3) Active space: 8e, 8o (orbitals 45–52 → Python indices 44–51)
    nocc = mol.nelectron // 2
    cas_start = 44
    ncas = 8
    mc = mcscf.CASSCF(mf, ncas, ncas)
    mc.frozen = cas_start  # freeze MOs 0–43
    mc.kernel()

    # 4) Extract integrals in active space
    h1, ecore = mc.get_h1cas()          # one-electron integrals and core energy
    eri = mc.get_h2cas()                # two-electron integrals (chemist’s notation)

    # 5) Save to disk
    np.save('integrals/h1_act.npy', h1)
    np.save('integrals/eri_act.npy', eri)
    np.save('integrals/ecore_act.npy', np.array([ecore]))
    print("Saved h1_act.npy, eri_act.npy, and ecore_act.npy in integrals/")

if __name__ == '__main__':
    p = argparse.ArgumentParser()
    p.add_argument('--basis', choices=['sto-3g','6-31g'], default='sto-3g')
    args = p.parse_args()
    main(args.basis)
#INFO: ******************** input file end ********************


System: uname_result(system='Darwin', node='Oms-MacBook-Air-2.local', release='23.6.0', version='Darwin Kernel Version 23.6.0: Mon Jul 29 21:16:46 PDT 2024; root:xnu-10063.141.2~1/RELEASE_ARM64_T8112', machine='arm64')  Threads 1
Python 3.13.3 (main, Apr  8 2025, 13:54:08) [Clang 16.0.0 (clang-1600.0.26.6)]
numpy 2.3.1  scipy 1.16.0  h5py 3.14.0
Date: Mon Jun 30 02:22:17 2025
PySCF version 2.9.0
PySCF path  /Users/omtailor/P3/.venv/lib/python3.13/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 21
[INPUT] num. electrons = 96
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 S      0.004272000000  -3.605455000000   0.075025000000 AA    0.008072910004  -6.813322504444   0.141776702495 Bohr   0.0
[INPUT]  2 C     -1.402531000000   1.178101000000   0.034395000000 AA   -2.650399471212   2.226288237076   0.064997130054 Bohr   0.0
[INPUT]  3 C      1.390144000000   1.184559000000   0.024814000000 AA    2.626991433707   2.238492088389   0.046891664055 Bohr   0.0
[INPUT]  4 C     -2.364956000000  -1.282920000000   0.060914000000 AA   -4.469119136647  -2.424367439727   0.115110777152 Bohr   0.0
[INPUT]  5 C      2.363033000000  -1.272400000000   0.044554000000 AA    4.465485193309  -2.404487520897   0.084194857754 Bohr   0.0
[INPUT]  6 C     -3.061455000000   3.228790000000   0.020779000000 AA   -5.785311492680   6.101528813734   0.039266619142 Bohr   0.0
[INPUT]  7 C      3.039864000000   3.242576000000  -0.000175000000 AA    5.744510415925   6.127580578088  -0.000330702072 Bohr   0.0
[INPUT]  8 C     -4.962189000000  -1.705629000000   0.073789000000 AA   -9.377178188329  -3.223171680116   0.139441001006 Bohr   0.0
[INPUT]  9 C      4.962074000000  -1.683853000000   0.039407000000 AA    9.376960869825  -3.182021004027   0.074468437391 Bohr   0.0
[INPUT] 10 C     -5.633788000000   2.804096000000   0.033418000000 AA  -10.646316363861   5.298973466988   0.063150867631 Bohr   0.0
[INPUT] 11 C      5.614015000000   2.828911000000  -0.005392000000 AA   10.608950809200   5.345867020769  -0.010189403264 Bohr   0.0
[INPUT] 12 C     -6.579851000000   0.342141000000   0.059842000000 AA  -12.434116330446   0.646552785985   0.113084990746 Bohr   0.0
[INPUT] 13 C      6.570636000000   0.370979000000   0.014369000000 AA   12.416702504208   0.701048707965   0.027153474684 Bohr   0.0
[INPUT] 14 H     -2.333026000000   5.140462000000   0.000248000000 AA   -4.408780181490   9.714065333734   0.000468652079 Bohr   0.0
[INPUT] 15 H      2.303015000000   5.151068000000  -0.015633000000 AA    4.352067610765   9.734107769011  -0.029542088505 Bohr   0.0
[INPUT] 16 H     -5.708071000000  -3.610468000000   0.094410000000 AA  -10.786690889572  -6.822795701506   0.178409043420 Bohr   0.0
[INPUT] 17 H      5.716340000000  -3.585436000000   0.054803000000 AA   10.802317034896  -6.775492077156   0.103562660805 Bohr   0.0
[INPUT] 18 H     -6.930402000000   4.385300000000   0.022809000000 AA  -13.096561713138   8.287015974055   0.043102763175 Bohr   0.0
[INPUT] 19 H      6.903770000000   4.415629000000  -0.024943000000 AA   13.046234526989   8.344329477687  -0.047135438725 Bohr   0.0
[INPUT] 20 H     -8.603197000000   0.036547000000   0.069553000000 AA  -16.257686125680   0.069063820674   0.131436121142 Bohr   0.0
[INPUT] 21 H      8.595293000000   0.074081000000   0.010080000000 AA   16.242749730391   0.139992801034   0.019048439336 Bohr   0.0

nuclear repulsion = 421.01016666375
number of shells = 83
number of NR pGTOs = 342
number of NR cGTOs = 137
basis = 6-31g
ecp = {}
CPU time:         0.28


******** <class 'pyscf.scf.hf.RHF'> ********
method = RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /var/folders/58/lygqmhgd1hlc8wz2cn49f70w0000gn/T/tmpiiz7d9j6
max_memory 4000 MB (current use 0 MB)
Set gradient conv threshold to 3.16228e-05
Initial guess from minao.
init E= -847.578580232814
  HOMO = -0.0800309607393746  LUMO = -0.0747678417347224
cycle= 1 E= -850.791623093023  delta_E= -3.21  |g|= 1.26  |ddm|= 3.81
  HOMO = -0.341855728450709  LUMO = -0.336115575931399
cycle= 2 E= -847.221817854857  delta_E= 3.57  |g|= 2.21  |ddm|= 4.37
  HOMO = -0.272590905275886  LUMO = -0.244005977034599
cycle= 3 E= -850.732531213906  delta_E= -3.51  |g|= 1.49  |ddm|= 3.81
  HOMO = -0.2259028817649  LUMO = -0.195346982378066
cycle= 4 E= -851.631757887682  delta_E= -0.899  |g|= 0.652  |ddm|= 1.18
  HOMO = -0.191979492734775  LUMO = -0.155236325378132
cycle= 5 E= -851.909497005499  delta_E= -0.278  |g|= 0.442  |ddm|= 1.21
  HOMO = -0.205537315413519  LUMO = -0.110430348534285
cycle= 6 E= -852.003364569186  delta_E= -0.0939  |g|= 0.263  |ddm|= 0.644
  HOMO = -0.21106641918804  LUMO = -0.108920280439663
cycle= 7 E= -852.039671888176  delta_E= -0.0363  |g|= 0.23  |ddm|= 0.48
  HOMO = -0.209927693443661  LUMO = -0.100057241583247
cycle= 8 E= -852.083267829345  delta_E= -0.0436  |g|= 0.175  |ddm|= 0.33
  HOMO = -0.209940806712704  LUMO = -0.0963642283899294
cycle= 9 E= -852.101885707901  delta_E= -0.0186  |g|= 0.172  |ddm|= 0.17
  HOMO = -0.206920751983228  LUMO = -0.0907332827564453
cycle= 10 E= -852.116711330267  delta_E= -0.0148  |g|= 0.171  |ddm|= 0.133
  HOMO = -0.209587164655072  LUMO = -0.0917608364422286
cycle= 11 E= -852.128281839542  delta_E= -0.0116  |g|= 0.181  |ddm|= 0.127
  HOMO = -0.207169991778967  LUMO = -0.0888686381545689
cycle= 12 E= -852.104799061305  delta_E= 0.0235  |g|= 0.16  |ddm|= 0.35
  HOMO = -0.21159720239676  LUMO = -0.0943367576727294
cycle= 13 E= -852.113590152259  delta_E= -0.00879  |g|= 0.0973  |ddm|= 0.723
  HOMO = -0.199643767335956  LUMO = -0.088157001020273
cycle= 14 E= -852.133045606268  delta_E= -0.0195  |g|= 0.107  |ddm|= 0.28
  HOMO = -0.193041750846805  LUMO = -0.0846610580215002
cycle= 15 E= -852.15915154438  delta_E= -0.0261  |g|=  0.1  |ddm|= 0.352
  HOMO = -0.188311545868386  LUMO = -0.0796135565902533
cycle= 16 E= -852.169410703884  delta_E= -0.0103  |g|= 0.101  |ddm|= 0.189
  HOMO = -0.19074053149796  LUMO = -0.0791183778542696
cycle= 17 E= -852.171319091196  delta_E= -0.00191  |g|= 0.106  |ddm|= 0.0385
  HOMO = -0.196075353941783  LUMO = -0.0893639033333488
cycle= 18 E= -852.120360454351  delta_E= 0.051  |g|= 0.0723  |ddm|= 0.763
  HOMO = -0.207772975085287  LUMO = -0.0975544198031118
cycle= 19 E= -852.113628943566  delta_E= 0.00673  |g|= 0.0689  |ddm|= 0.293
  HOMO = -0.206987569698988  LUMO = -0.0978814366573115
cycle= 20 E= -852.113897883977  delta_E= -0.000269  |g|= 0.0544  |ddm|= 0.0798
  HOMO = -0.207281701506162  LUMO = -0.0998529237790313
cycle= 21 E= -852.113589005148  delta_E= 0.000309  |g|= 0.0483  |ddm|= 0.163
  HOMO = -0.207769961551164  LUMO = -0.100706675600511
cycle= 22 E= -852.114236345516  delta_E= -0.000647  |g|= 0.0367  |ddm|= 0.0925
  HOMO = -0.206656421184545  LUMO = -0.100907726007684
cycle= 23 E= -852.115682839365  delta_E= -0.00145  |g|= 0.0314  |ddm|= 0.0929
  HOMO = -0.206335351191514  LUMO = -0.100658890870882
cycle= 24 E= -852.115939630845  delta_E= -0.000257  |g|= 0.0325  |ddm|= 0.0161
  HOMO = -0.204927916881922  LUMO = -0.0996734529731613
cycle= 25 E= -852.11768776272  delta_E= -0.00175  |g|= 0.0375  |ddm|= 0.0858
  HOMO = -0.20270699464885  LUMO = -0.0980056257673047
cycle= 26 E= -852.117646637186  delta_E= 4.11e-05  |g|= 0.0441  |ddm|= 0.0663
  HOMO = -0.203466729107291  LUMO = -0.0983461124052908
cycle= 27 E= -852.117556793852  delta_E= 8.98e-05  |g|= 0.0472  |ddm|= 0.0475
  HOMO = -0.203333369004339  LUMO = -0.0984396424281497
cycle= 28 E= -852.11730266321  delta_E= 0.000254  |g|= 0.0493  |ddm|= 0.0431
  HOMO = -0.202056166279648  LUMO = -0.0972696481723398
cycle= 29 E= -852.117520717504  delta_E= -0.000218  |g|= 0.0447  |ddm|= 0.0632
  HOMO = -0.203954505728337  LUMO = -0.0997533760539114
cycle= 30 E= -852.116944234758  delta_E= 0.000576  |g|= 0.033  |ddm|= 0.188
  HOMO = -0.206400204145869  LUMO = -0.102060779310977
cycle= 31 E= -852.117517458689  delta_E= -0.000573  |g|= 0.0459  |ddm|= 0.122
  HOMO = -0.203181591305886  LUMO = -0.0981357686916966
cycle= 32 E= -852.116816358008  delta_E= 0.000701  |g|= 0.0421  |ddm|= 0.275
  HOMO = -0.20408653532259  LUMO = -0.099552562403187
cycle= 33 E= -852.118363670243  delta_E= -0.00155  |g|= 0.0526  |ddm|= 0.156
  HOMO = -0.207870901684306  LUMO = -0.103977804458076
cycle= 34 E= -852.117551944306  delta_E= 0.000812  |g|= 0.049  |ddm|= 0.223
  HOMO = -0.207191100170553  LUMO = -0.102389969524988
cycle= 35 E= -852.115731779873  delta_E= 0.00182  |g|= 0.0315  |ddm|= 0.13
  HOMO = -0.206921977538765  LUMO = -0.102088940222153
cycle= 36 E= -852.115144742745  delta_E= 0.000587  |g|= 0.0219  |ddm|= 0.0827
  HOMO = -0.208746363559318  LUMO = -0.103571927898012
cycle= 37 E= -852.115291809503  delta_E= -0.000147  |g|= 0.0174  |ddm|= 0.0892
  HOMO = -0.211011434685267  LUMO = -0.105450517531911
cycle= 38 E= -852.115410470706  delta_E= -0.000119  |g|= 0.0199  |ddm|= 0.133
  HOMO = -0.21535739057568  LUMO = -0.108350834905793
cycle= 39 E= -852.114774452737  delta_E= 0.000636  |g|= 0.03  |ddm|= 0.154
  HOMO = -0.217636556826219  LUMO = -0.110025793305698
cycle= 40 E= -852.113768678956  delta_E= 0.00101  |g|= 0.0434  |ddm|= 0.0795
  HOMO = -0.214309597331798  LUMO = -0.107396555339922
cycle= 41 E= -852.114892432853  delta_E= -0.00112  |g|= 0.0209  |ddm|= 0.117
  HOMO = -0.21213172346163  LUMO = -0.106728697277646
cycle= 42 E= -852.115131150188  delta_E= -0.000239  |g|= 0.0172  |ddm|= 0.0748
  HOMO = -0.210830116561619  LUMO = -0.105346307832829
cycle= 43 E= -852.115125869185  delta_E= 5.28e-06  |g|= 0.0104  |ddm|= 0.0572
  HOMO = -0.212098653059496  LUMO = -0.106601519129379
cycle= 44 E= -852.11518824652  delta_E= -6.24e-05  |g|= 0.0088  |ddm|= 0.0529
  HOMO = -0.211774298316902  LUMO = -0.106158523864266
cycle= 45 E= -852.115352073813  delta_E= -0.000164  |g|= 0.00789  |ddm|= 0.0273
  HOMO = -0.211227178083427  LUMO = -0.105725833218155
cycle= 46 E= -852.115385675836  delta_E= -3.36e-05  |g|= 0.00737  |ddm|= 0.023
  HOMO = -0.212060165548911  LUMO = -0.106389326532542
cycle= 47 E= -852.115246529583  delta_E= 0.000139  |g|= 0.00775  |ddm|= 0.0471
  HOMO = -0.212817593851875  LUMO = -0.107116786735484
cycle= 48 E= -852.115050199623  delta_E= 0.000196  |g|= 0.00832  |ddm|= 0.0395
  HOMO = -0.212345433659042  LUMO = -0.106562077154337
cycle= 49 E= -852.115220310267  delta_E= -0.00017  |g|= 0.00866  |ddm|= 0.0314
  HOMO = -0.212174777248449  LUMO = -0.106458441022617
cycle= 50 E= -852.115097456108  delta_E= 0.000123  |g|= 0.0058  |ddm|= 0.0275
SCF not converged.
SCF energy = -852.115097456108
RHF/6-31g energy = -852.115097 Ha

******** <class 'pyscf.mcscf.mc1step.CASSCF'> ********
CAS (4e+4e, 8o), ncore = 44, nvir = 85
frozen orbitals 44
max_cycle_macro = 50
max_cycle_micro = 4
conv_tol = 1e-07
conv_tol_grad = None
orbital rotation max_stepsize = 0.02
orbital rotation threshold for CI restart = 0.01
augmented hessian ah_max_cycle = 30
augmented hessian ah_conv_tol = 1e-12
augmented hessian ah_linear dependence = 1e-14
augmented hessian ah_level shift = 1e-08
augmented hessian ah_start_tol = 2.5
augmented hessian ah_start_cycle = 3
augmented hessian ah_grad_trust_region = 3
kf_trust_region = 3
kf_interval = 4
ci_response_space = 4
ci_grad_trust_region = 3
with_dep4 0
natorb = False
canonicalization = True
sorting_mo_energy = False
ao2mo_level = 2
chkfile = /var/folders/58/lygqmhgd1hlc8wz2cn49f70w0000gn/T/tmpiiz7d9j6
max_memory 4000 MB (current use 0 MB)
internal_rotation = False
******** <class 'pyscf.fci.direct_spin1.FCISolver'> ********
max. cycles = 50
conv_tol = 1e-08
davidson only = False
linear dependence = 1e-12
level shift = 0.001
max iter space = 12
max_memory 4000 MB
nroots = 1
pspace_size = 400
spin = None
CASCI E = -852.452127676242  S^2 = 0.5524948
Set conv_tol_grad to 0.000316228
macro iter   1 ( 21 JK    4 micro), CASSCF E = -852.534914000105  dE = -8.27863239e-02  S^2 = 0.1576691
               |grad[o]|=0.143  |grad[c]|=0.0761  |ddm|=0.119  |maxRot[o]|=0.248
macro iter   2 ( 21 JK    4 micro), CASSCF E = -852.544152157397  dE = -9.23815729e-03  S^2 = 0.0551371
               |grad[o]|=0.0436  |grad[c]|=0.00947  |ddm|=0.0487  |maxRot[o]|=0.301
macro iter   3 ( 21 JK    4 micro), CASSCF E = -852.548189092115  dE = -4.03693472e-03  S^2 = 0.0178486
               |grad[o]|=0.0174  |grad[c]|=0.00407  |ddm|=0.0106  |maxRot[o]|=0.309
macro iter   4 ( 21 JK    4 micro), CASSCF E = -852.550718994149  dE = -2.52990203e-03  S^2 = 0.0164503
               |grad[o]|=0.00886  |grad[c]|=0.00337  |ddm|=0.0229  |maxRot[o]|=0.308
macro iter   5 ( 19 JK    4 micro), CASSCF E = -852.552057590989  dE = -1.33859684e-03  S^2 = 0.0160196
               |grad[o]|=0.00416  |grad[c]|=0.00482  |ddm|=0.0218  |maxRot[o]|=0.198
macro iter   6 ( 12 JK    3 micro), CASSCF E = -852.552132943262  dE = -7.53522726e-05  S^2 = 0.0161247
               |grad[o]|=0.00175  |grad[c]|=0.000985  |ddm|=0.00581  |maxRot[o]|=0.0383
macro iter   7 (  3 JK    1 micro), CASSCF E = -852.552133407627  dE = -4.64365485e-07  S^2 = 0.0161904
               |grad[o]|=0.00013  |grad[c]|=0.000124  |ddm|=0.00033  |maxRot[o]|=0.00236
macro iter   8 (  3 JK    1 micro), CASSCF E = -852.552133470730  dE = -6.31024477e-08  S^2 = 0.0161947
               |grad[o]|=6.89e-05  |grad[c]|=6.35e-05  |ddm|=    0  |maxRot[o]|=0.00114
1-step CASSCF converged in   8 macro (121 JK  25 micro) steps
CASSCF canonicalization
Density matrix diagonal elements [1.98076063 1.85086125 0.9995331  0.99987029 1.00011309 0.99985294
 0.05784375 0.11116495]
CASSCF energy = -852.552133470730
CASCI E = -852.552133470730  E(CI) = -6.02081228629152  S^2 = 0.0161947
Saved h1_act.npy, eri_act.npy, and ecore_act.npy in integrals/
